<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up</title>
    <link rel="stylesheet" href="css/signup.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    
</head>
<body>
    <div>
        <a href="index.html"><span class="material-symbols-outlined">
            arrow_back
        </span></a>
    </div>
    <form action="javascript:alert('회원가입 완료');" class="joinForm" name="userForm">
        <h3>회원가입</h3>
        <div class="textForm">
            <input type="text" name="userId" id="userId" class="id" placeholder="아이디를 입력하세요." required>
        </div>
        <div class="textForm">
            <input type="password" name="pwd" id="pwd" class="pw" placeholder="비밀번호를 입력하세요." required>
        </div>
        <div class="textForm">
            <input type="password" id="pwdCheck" class="pwcheck" placeholder="비밀번호를 다시 입력하세요." required>                 
        </div>
        
            <div class="textForm">
            <input type="text" name="username" id="username" class="name" placeholder="이름을 입력하세요." required>
        </div>     
        <div class="textForm">
            <input type="text" name="phone1" id="phone1" maxlength="3" oninput="nextPhone1()" required>-
            <input type="text" name="phone2" id="phone2" maxlength="4" oninput="nextPhone2()" required>-
            <input type="text" name="phone3" id="phone3" maxlength="4" oninput="nextPhone3()" required>
        </div>
        <div class="textForm">
            <input type="text" name="email" id="email" class="email" placeholder="이메일을 입력하세요." required>
        </div>
        <input type="submit" class="btn" value="가 입 하 기">
    </form>

    <script>
        // 비밀번호/비밀번호 체크 일치여부 검사
        document.querySelector("#pwdCheck").onblur = isEqualPwd; 
 
         document.userForm.onsubmit = function () {
         const userId = document.getElementById("userId");
         const pwd = document.getElementById("pwd");
         const pwdCheck = document.getElementById("pwdCheck");
         const username = document.getElementById("username");      
         const phone1 = document.getElementById("phone1");
         const phone2 = document.getElementById("phone2");
         const phone3 = document.getElementById("phone3");
         const email = document.getElementById("email");
  
         const regExp1 = /^[a-z][a-z\d]{3,11}$/;
         const regExp2 = /[0-9]/;
         if(!regExpTest(regExp1,userId,"아이디는 영소문자로 시작하는 4~12글자입니다."))
             return false;
         if(!regExpTest(regExp2,userId,"아이디는 숫자를 하나이상 포함하세요."))
             return false;
 
         const regExpArr = [/^.{8,12}$/, /\d/, /[a-zA-Z]/, /[\\*!&]/];

         for (let i = 0; i < regExpArr.length; i++) {
             if (
             !regExpTest(
                 regExpArr[i],pwd,"비밀번호는 8~12자리 숫자/문자/특수문자를 포함해야합니다."
             )
             ) {
             return false;
             }
         }
 
         //비밀번호일치여부
         if (!isEqualPwd()) {
             return false;
         }
 
         const regExp3 = /^[가-힣]{2,}$/;
         if (!regExpTest(regExp3, username, "한글2글자이상 입력하세요."))
             return false;

         if (
             !regExpTest(
             /^[\w]{4,}@[\w]+(\.[\w]+){1,3}$/,email,"이메일 형식에 맞지 않습니다."
             )
         )
             return false;

         if (!regExpTest(/^010$/, phone1, "010으로 시작하는 번호를 입력하세요")) return false;
         if (!regExpTest(/^[0-9]{3,4}$/, phone2, "4자리 번호 입력"))
             return false;
         if (!regExpTest(/^[0-9]{4}$/, phone3, "4자리 번호 입력")) return false;
 
         return true;
         };

         //전번 자동이동
         function nextPhone1(){
             const phone1 = document.getElementById("phone1").value
             if(phone1.length == 3){
                 document.getElementById('phone2').focus();
             }
         }

         function nextPhone2(){
             const phone2 = document.getElementById("phone2").value
             if(phone2.length == 4){
                 document.getElementById('phone3').focus();
             }
         }

         function nextPhone3(){
             const phone3 = document.getElementById("phone3").value
             if(phone3.length == 4){
                 document.getElementById('email').focus();
             }
         }
   
         function isEqualPwd() {
         if (pwd.value == pwdCheck.value) {
             return true;
         } else {
             alert("비밀번호가 일치하지 않습니다.");
             pwd.select();
             return false;
         }
        }

         //  검사 함수
         function regExpTest(regExp, e, msg) {
         if (regExp.test(e.value)) return true;
         alert(msg);
         e.value = "";
         e.select();
         return false;
         }

         
         </script>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

<form action="javascript:saveUser();" name="userFrm">
    <button class="button">회원정보 출력</button><br>
</form>
<table id="tb-userlist">
    <thead>
        <tr>
            <th>No</th>
            <th>아이디</th>
            <th>비밀번호</th>
            <th>이름</th>
            <th>이메일</th>
            <th>가입일자</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<script>  
            class UserList {
            constructor(userId,pwd,username,email,datetime = Date.now()){
            this.userId = userId;
            this.pwd = pwd;
            this.username = username;
            this.email = email;
            this.datetime = datetime; 
    }
  }
          
          const saveUser = () => {

            const userIdVal = userId.value;
            const pwdVal = pwd.value;
            const usernameVal = username.value;
            const emailVal = email.value;

            const userSet = new UserList(userIdVal, pwdVal, usernameVal, emailVal);
            //  console.log(userSet);

            const userSets = JSON.parse(localStorage.getItem("userSets")) || [];
            userSets.push(userSet);
            console.log(userSets);
       
            const data = JSON.stringify(userSets);
            console.log(data);

            // localStorage에 저장
            localStorage.setItem('userSets', data);
            // 초기화
            document.userForm.reset();
            // 렌더링
            renderUserList(userSets);
         };
         
         const renderUserList = (userSets = JSON.parse(localStorage.getItem("userSets"))) => {
            if(!userSets) return; 
            const tbody = document.querySelector("#tb-userlist tbody");
             tbody.innerHTML = "";
             userSets
                .map((userSet, index)=>{
                 const {userId,pwd,username,email,datetime} = userSet;
                 return `<tr>
                    <td>${index+1}</td>
                    <td>${userId}</td>
                    <td>${pwd}</td>
                    <td>${username}</td>
                    <td>${email}</td>
                    <td>${datetimeFormatter(datetime)}</td>
                 </tr>`;
                })
                .forEach((tr) => {
                    tbody.innerHTML += tr;
                });
         }
         const datetimeFormatter = (millis) => {
            const d = new Date(millis);
            const f = (n) => n < 10 ? '0' + n : n;
            const yyyy = d.getFullYear();
            const mm = f(d.getMonth() + 1);
            const dd = f(d.getDate());
            return `${yyyy}년 ${mm}월 ${dd}일`;
         }
         window.localStorage.clear();
</script>
</body>
</html>